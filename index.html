<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0b0b" />
  <title>محلات أبو ياسر زعرب وأولاده (أبو عماد)</title>

  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header class="top">
    <div class="brand">
      <div class="title">محلات أبو ياسر زعرب وأولاده</div>
      <div class="subtitle">( أبو عماد )</div>
    </div>
    <div class="meta">
      <div id="today"></div>
      <button id="btnBackup" class="ghost">نسخ احتياطي</button>
      <label class="ghost file">
        استيراد
        <input id="fileImport" type="file" accept="application/json" />
      </label>
    </div>
  </header>

  <nav class="tabs" aria-label="القائمة">
    <button class="tab active" data-view="items">الأصناف</button>
    <button class="tab" data-view="purchase">شراء</button>
    <button class="tab" data-view="sale">بيع</button>
    <button class="tab" data-view="inventory">المخزون</button>
    <button class="tab" data-view="partners">موردين/زبائن</button>
    <button class="tab" data-view="debts">غرفة الديون</button>
  </nav>

  <main class="wrap">

    <!-- ITEMS -->
    <section class="view active" id="view-items">
      <div class="card">
        <h2>الأصناف والأسعار</h2>
        <form id="formItem" class="grid">
          <input id="itemName" placeholder="اسم الصنف (مثلاً: دجاج)" required />
          <input id="itemBuy" type="number" step="0.01" min="0" placeholder="سعر شراء/كغم" required />
          <input id="itemSell" type="number" step="0.01" min="0" placeholder="سعر بيع/كغم" required />
          <input id="itemMin" type="number" step="0.01" min="0" placeholder="حد تنبيه مخزون (اختياري)" />
          <button class="primary" type="submit">إضافة / حفظ</button>
          <button class="danger" type="button" id="btnItemReset">مسح الحقول</button>
        </form>

        <div class="hint">ملاحظة: السعر الافتراضي قابل للتعديل داخل الفواتير.</div>

        <div class="tableWrap">
          <table class="table" id="itemsTable">
            <thead>
              <tr>
                <th>الصنف</th>
                <th>شراء/كغم</th>
                <th>بيع/كغم</th>
                <th>حد التنبيه</th>
                <th>إجراءات</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- PURCHASE -->
    <section class="view" id="view-purchase">
      <div class="card">
        <h2>فاتورة شراء (توريد) — تزيد المخزون</h2>

        <form id="formPurchase" class="grid2">
          <input id="purchasePartner" placeholder="اسم المورد" required />
          <select id="purchaseItem" required></select>
          <input id="purchaseQty" type="number" step="0.01" min="0.01" placeholder="الوزن (كغم)" required />
          <input id="purchasePrice" type="number" step="0.01" min="0" placeholder="سعر شراء/كغم" required />
          <button class="primary" type="submit">إضافة سطر</button>
          <button class="ghost" type="button" id="purchaseClear">مسح السطور</button>
        </form>

        <div class="tableWrap">
          <table class="table" id="purchaseLines">
            <thead>
              <tr>
                <th>الصنف</th>
                <th>كغم</th>
                <th>سعر/كغم</th>
                <th>المجموع</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="footerRow">
          <div class="totals">
            <div>إجمالي الفاتورة: <b id="purchaseTotal">0</b></div>
          </div>
          <div class="pay">
            <select id="purchasePayType">
              <option value="cash">نقدي</option>
              <option value="credit">آجل (دين)</option>
              <option value="partial">جزئي</option>
            </select>
            <input id="purchasePaid" type="number" step="0.01" min="0" placeholder="المدفوع (للجزئي)" />
            <button class="primary" id="purchaseSave" type="button">حفظ الفاتورة</button>
          </div>
        </div>
      </div>
    </section>

    <!-- SALE -->
    <section class="view" id="view-sale">
      <div class="card">
        <h2>فاتورة بيع — تنقص المخزون</h2>

        <form id="formSale" class="grid2">
          <input id="salePartner" placeholder="اسم الزبون/المُصدّر" required />
          <select id="saleItem" required></select>
          <input id="saleQty" type="number" step="0.01" min="0.01" placeholder="الوزن (كغم)" required />
          <input id="salePrice" type="number" step="0.01" min="0" placeholder="سعر بيع/كغم" required />
          <button class="primary" type="submit">إضافة سطر</button>
          <button class="ghost" type="button" id="saleClear">مسح السطور</button>
        </form>

        <div class="hint" id="saleStockHint"></div>

        <div class="tableWrap">
          <table class="table" id="saleLines">
            <thead>
              <tr>
                <th>الصنف</th>
                <th>كغم</th>
                <th>سعر/كغم</th>
                <th>المجموع</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="footerRow">
          <div class="totals">
            <div>إجمالي الفاتورة: <b id="saleTotal">0</b></div>
          </div>
          <div class="pay">
            <select id="salePayType">
              <option value="cash">نقدي</option>
              <option value="credit">آجل (دين)</option>
              <option value="partial">جزئي</option>
            </select>
            <input id="salePaid" type="number" step="0.01" min="0" placeholder="المدفوع (للجزئي)" />
            <button class="primary" id="saleSave" type="button">حفظ الفاتورة</button>
          </div>
        </div>
      </div>
    </section>

    <!-- INVENTORY -->
    <section class="view" id="view-inventory">
      <div class="card">
        <h2>المخزون الحالي</h2>

        <div class="grid2">
          <select id="adjItem"></select>
          <input id="adjQty" type="number" step="0.01" placeholder="تعديل (+ أو -) كغم" />
          <input id="adjReason" placeholder="سبب التعديل (جرد/تلف/هدر...)" />
          <button class="primary" id="btnAdjust" type="button">تنفيذ التعديل</button>
        </div>

        <div class="tableWrap">
          <table class="table" id="invTable">
            <thead>
              <tr>
                <th>الصنف</th>
                <th>المتوفر (كغم)</th>
                <th>تنبيه</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="hint">التنبيه يظهر إذا نزل المخزون تحت الحد المحدد للصنف.</div>
      </div>
    </section>

    <!-- PARTNERS -->
    <section class="view" id="view-partners">
      <div class="card">
        <h2>الموردين والزبائن</h2>

        <form id="formPartner" class="grid2">
          <select id="partnerType" required>
            <option value="supplier">مورد</option>
            <option value="customer">زبون/مُصدّر</option>
          </select>
          <input id="partnerName" placeholder="الاسم" required />
          <input id="partnerPhone" placeholder="رقم (اختياري)" />
          <button class="primary" type="submit">إضافة</button>
          <button class="danger" type="button" id="btnPartnerReset">مسح الحقول</button>
        </form>

        <div class="tableWrap">
          <table class="table" id="partnersTable">
            <thead>
              <tr>
                <th>النوع</th>
                <th>الاسم</th>
                <th>الهاتف</th>
                <th>الرصيد</th>
                <th>إجراءات</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="hint">
          الرصيد: للمورد = (علينا)، للزبون = (إلنا عليه). القيم السالبة تعني العكس.
        </div>
      </div>
    </section>

    <!-- DEBTS -->
    <section class="view" id="view-debts">
      <div class="card">
        <h2>غرفة الديون</h2>

        <div class="twoCols">
          <div>
            <h3>ديون الموردين (علينا)</h3>
            <div class="tableWrap">
              <table class="table" id="supDebts">
                <thead>
                  <tr><th>المورد</th><th>المبلغ</th><th>تسديد</th></tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <div>
            <h3>ديون الزبائن (إلنا عليهم)</h3>
            <div class="tableWrap">
              <table class="table" id="cusDebts">
                <thead>
                  <tr><th>الزبون</th><th>المبلغ</th><th>قبض</th></tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="hint">التسديد/القبض يسجل حركة ويعدّل الرصيد مباشرة.</div>
      </div>
    </section>

  </main>

  <footer class="bottom">
    <div>يعمل بدون نت بعد أول فتح. البيانات محفوظة على نفس الجهاز.</div>
  </footer>

  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
    }
  </script>
</body>
</html>
